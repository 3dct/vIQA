name: Upload to PyPI
on:
#    workflow_run:
#        workflows: ["Build wheels and sdist"]
#        types:
#        - completed
    workflow_dispatch:

jobs:
    upload_pypi:
        runs-on: ubuntu-latest
        environment: pypi
        permissions:
            id-token: write
        # if: github.event_name == 'release' && github.event.action == 'published'
        # or, alternatively, upload to PyPI on every tag starting with 'v' (remove on: release above to use this)
        # if: github.event_name == 'push' && startsWith(github.ref, 'refs/tags/v')
        steps:
            - uses: actions/download-artifact@v4
              with:
                  # unpacks all CIBW artifacts into dist/
                  pattern: cibw-*
                  path: dist
                  merge-multiple: true

            - uses: pypa/gh-action-pypi-publish@release/v1
              with:
                repository-url: https://test.pypi.org/legacy/